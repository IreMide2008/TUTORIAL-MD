require("dotenv").config();
const fs = require("fs-extra");
const path = require("path");
const pino = require("pino");
const chalk = require("chalk");
const TelegramBot = require("node-telegram-bot-api");
const express = require("express");

// Import your new modules
const { TELEGRAM_TOKEN } = require("./token");
const { incrementReset, resetData } = require("./resetManager");

const {
    default: makeWASocket,
    useMultiFileAuthState,
    fetchLatestBaileysVersion,
    Browsers,
    DisconnectReason,
    makeCacheableSignalKeyStore
} = require("@whiskeysockets/baileys");

const app = express();
const PORT = process.env.PORT || 3000;

app.get('/', (req, res) => res.send('TUTORIAL-MD is Online! 🚀'));
app.listen(PORT, () => console.log(chalk.green(`🌍 Server active on port ${PORT}`)));

const bot = new TelegramBot(TELEGRAM_TOKEN, { polling: true });

// ===============================
//        TELEGRAM INTERFACE
// ===============================
bot.onText(/\/start/, (msg) => {
    bot.sendMessage(msg.chat.id, `🚀 *TUTORIAL–MD* 🚀\n\n✨ /pair <number>\n✨ /uptime\n\nTotal System Resets: ${resetData.count}`, { parse_mode: "Markdown" });
});

bot.onText(/\/pair (.+)/, async (msg, match) => {
    let phoneNumber = match[1].replace(/\D/g, "");
    bot.sendMessage(msg.chat.id, `⏳ Generating code for +${phoneNumber}...`);
    startWhatsAppBot(phoneNumber, msg.chat.id);
});

// ===============================
//     WHATSAPP CORE LOGIC
// ===============================
async function startWhatsAppBot(phoneNumber, telegramChatId = null) {
    const sessionDir = path.join(__dirname, 'sessions', `session_${phoneNumber}`);
    await fs.ensureDir(sessionDir);

    const { version } = await fetchLatestBaileysVersion();
    const { state, saveCreds } = await useMultiFileAuthState(sessionDir);

    const sock = makeWASocket({
        version,
        logger: pino({ level: "silent" }),
        browser: Browsers.ubuntu("Chrome"),
        auth: {
            creds: state.creds,
            keys: makeCacheableSignalKeyStore(state.keys, pino({ level: "silent" }))
        }
    });

    sock.ev.on("creds.update", saveCreds);

    if (!state.creds?.registered && telegramChatId) {
        setTimeout(async () => {
            try {
                let code = await sock.requestPairingCode(phoneNumber);
                code = code?.match(/.{1,4}/g)?.join("-") || code;
                bot.sendMessage(telegramChatId, `✅ *CODE:* \`${code}\``, { parse_mode: "Markdown" });
            } catch (e) {
                bot.sendMessage(telegramChatId, "❌ Request failed.");
            }
        }, 3000);
    }

    sock.ev.on("connection.update", (update) => {
        const { connection, lastDisconnect } = update;
        if (connection === "open") {
            console.log(chalk.green(`✅ Connected: ${phoneNumber}`));
            if (telegramChatId) bot.sendMessage(telegramChatId, `🎉 Connected!`);
        }
        if (connection === "close") {
            const reason = lastDisconnect?.error?.output?.statusCode;
            if (reason !== DisconnectReason.loggedOut) {
                incrementReset("auto-reconnect");
                startWhatsAppBot(phoneNumber, telegramChatId);
            }
        }
    });

    sock.ev.on("messages.upsert", async ({ messages, type }) => {
        if (type !== "notify") return;
        try {
            const handler = require("./main");
            await handler(sock, messages[0]);
        } catch (e) {}
    });
}

console.log(chalk.cyan.bold("🚀 TUTORIAL-MD System Initialized..."));