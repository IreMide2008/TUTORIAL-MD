const fs = require('fs');
const path = require('path');
const chalk = require('chalk');

// Global object to store loaded plugins
const plugins = new Map();
const prefix = "."; // Change this to your preferred prefix

// --- PLUGIN LOADER ---
const loadPlugins = () => {
    const pluginFolder = path.join(__dirname, 'plugins');
    if (!fs.existsSync(pluginFolder)) fs.mkdirSync(pluginFolder);

    const files = fs.readdirSync(pluginFolder).filter(file => file.endsWith('.js'));
    
    for (const file of files) {
        try {
            const plugin = require(`./plugins/${file}`);
            if (plugin.name) {
                plugins.set(plugin.name, plugin);
                console.log(chalk.green(`✅ Loaded Plugin: ${plugin.name}`));
            }
        } catch (e) {
            console.log(chalk.red(`❌ Failed to load ${file}:`), e);
        }
    }
    console.log(chalk.blue(`🚀 Total Plugins Active: ${plugins.size}`));
};

// Initial load
loadPlugins();

// --- THE HANDLER ---
module.exports = async (sock, m) => {
    try {
        const messageType = Object.keys(m.message)[0];
        const body = (messageType === 'conversation') ? m.message.conversation :
                     (messageType === 'extendedTextMessage') ? m.message.extendedTextMessage.text :
                     (messageType === 'imageMessage' || messageType === 'videoMessage') ? m.message[messageType].caption : "";

        if (!body.startsWith(prefix)) return;

        const args = body.slice(prefix.length).trim().split(/ +/);
        const commandName = args.shift().toLowerCase();
        
        const plugin = plugins.get(commandName);

        if (plugin) {
            console.log(chalk.cyan(`[COMMAND] ${m.pushName || 'User'}: ${commandName}`));
            await plugin.execute(m, sock, { args, prefix, plugins });
        }
    } catch (err) {
        console.error(chalk.red("Error in main handler:"), err);
    }
};